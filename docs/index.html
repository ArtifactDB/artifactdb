<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://code.roche.com/vida/artifactdb.js" target="_blank" class="menu-item" id="repository" >Code Repo</a></h2><h3>Classes</h3><ul><li><a href="HttpError.html">HttpError</a></li></ul><h3>Global</h3><ul><li><a href="global.html#abortUpload">abortUpload</a></li><li><a href="global.html#completeUpload">completeUpload</a></li><li><a href="global.html#createUploadStartUrl">createUploadStartUrl</a></li><li><a href="global.html#extractByNameOrIndex">extractByNameOrIndex</a></li><li><a href="global.html#getFile">getFile</a></li><li><a href="global.html#getFileMetadata">getFileMetadata</a></li><li><a href="global.html#getPermissions">getPermissions</a></li><li><a href="global.html#getProjectMetadata">getProjectMetadata</a></li><li><a href="global.html#getProjectMetadataNext">getProjectMetadataNext</a></li><li><a href="global.html#globalRequestHeaders">globalRequestHeaders</a></li><li><a href="global.html#initializeUpload">initializeUpload</a></li><li><a href="global.html#listProjects">listProjects</a></li><li><a href="global.html#listProjectsNext">listProjectsNext</a></li><li><a href="global.html#listProjectVersions">listProjectVersions</a></li><li><a href="global.html#packId">packId</a></li><li><a href="global.html#parseLinkHeader">parseLinkHeader</a></li><li><a href="global.html#setPermissions">setPermissions</a></li><li><a href="global.html#unpackId">unpackId</a></li><li><a href="global.html#uploadFiles">uploadFiles</a></li><li><a href="global.html#uploadProject">uploadProject</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>Javascript API for ArtifactDB</h1>
<h2>Overview</h2>
<p>This package implements a Javascript client for ArtifactDB instances, equivalent to the <a href="https://github.com/ArtifactDB/zircon-R"><strong>zircon</strong></a> client for R.
It provides the usual helper functions to pull individual files and metadata, project-level information or permissions.
It also provides methods to upload new versions to the ArtifactDB backend, given the appropriate authorization.
The general aim is to enable the use of ArtifactDB in Javascript-based web applications, though the same code works in Node.js environments as well.</p>
<h2>Quick start</h2>
<p>Install this package from NPM:</p>
<pre class="prettyprint source lang-sh"><code>npm install whoople
</code></pre>
<p>We'll use the test <a href="https://github.com/ArtifactDB/gypsum-worker"><strong>gypsum</strong></a> instance to run our examples.
<strong>whoople</strong> uses ES6 syntax, so:</p>
<pre class="prettyprint source lang-js"><code>import * as adb from &quot;whoople&quot;;

let example_url = &quot;https://gypsum-test.aaron-lun.workers.dev&quot;;

// Fetch metadata for a file:
let meta = await adb.getFileMetadata(example_url, &quot;test-zircon-upload:blah.txt@base&quot;);

// Fetch the file contents (defaulting to ArrayBuffer):
let contents = await adb.getFile(example_url, &quot;test-zircon-upload:blah.txt@base&quot;);

// Fetch all files for a given project's version:
let project_meta = await adb.getProjectMetadata(example_url, &quot;test-zircon-upload&quot;, { version: &quot;base&quot; });

// See the project permissions:
let project_perm = await adb.getPermissions(example_url, &quot;test-zircon-upload&quot;);

// List available versions:
let project_versions = await adb.listProjectVersions(example_url, &quot;test-zircon-upload&quot;);
</code></pre>
<p>Check out the <a href="https://artifactdb.github.io/whoople">reference documentation</a> for more details.</p>
<h2>Using a different request function</h2>
<p>By default, we use the web API's <code>fetch()</code> to do all requests.
Users can adjust the <code>globalRequestHeaders</code> to add headers to each request, typically for authentication:</p>
<pre class="prettyprint source lang-js"><code>adb.globalRequestHeaders[&quot;Authorization&quot;] = &quot;Bearer &quot; + token;

// Now we can access non-public resources for the user's token:
let contents = await adb.getFile(example_url, some_non_public_file);
</code></pre>
<p>Users can also override the request function directly by supplying their own function that returns a <code>Response</code> object.
This may be useful for older versions of Node.js where the <code>fetch()</code> function may not be available (and a polyfill is not appropriate, for whatever reason).</p>
<pre class="prettyprint source lang-js"><code>import * as https from &quot;https&quot;;

async function newGet(url) {
    /* Some implementation based on https.get() */
}

let contents = await adb.getFile(example_url, some_non_public_file, { getFun: newGet });
</code></pre>
<h2>Uploading to ArtifactDB</h2>
<p>Authorized users can also upload projects to ArtifactDB.</p>
<pre class="prettyprint source lang-js"><code>// Defining the files inside our project.
let contents = {
    &quot;foo&quot;: &quot;&lt;CONTENTS AS A STRING OR ARRAYBUFFER>&quot;,
    &quot;foo.json&quot;: &quot;&lt;JSON METADATA AS A STRING OR ARRAYBUFFER>&quot;,
    &quot;bar.txt&quot;: &quot;&lt;CONTENTS AS A STRING OR ARRAYBUFFER>&quot;,
    &quot;bar.txt.json&quot;: &quot;&lt;JSON METADATA AS A STRING OR ARRAYBUFFER>&quot;,
    &quot;whee/stuff.csv.gz&quot;: &quot;&lt;CONTENTS AS A STRING OR ARRAYBUFFER>&quot;,
    &quot;whee/stuff.csv.gz.json&quot;: &quot;&lt;JSON METADATA AS A STRING OR ARRAYBUFFER>&quot;
};

// Computing their checksums.
import * as hash from &quot;hash-wasm&quot;;
let checksums = {};
for (const [k, v] of Object.entries(contents)) {
    checksums[k] = await hash.md5(v);
}

// Performing the upload. For test projects, we'll set a 1-day expiry.
await adb.uploadProject(
    example_url, 
    &quot;test-zircon-upload&quot;, 
    &quot;my_test_version&quot;, 
    checksums, 
    contents, 
    { initArgs: { expires: 1 } }
);
</code></pre>
<p>A similar code chunk can be used to create new versions of an existing project, without downloading the existing contents.</p>
<pre class="prettyprint source lang-js"><code>import * as hash from &quot;hash-wasm&quot;;
let existing = getProjectMetadata(example_url, &quot;test-zircon-upload&quot;, &quot;base&quot;);

let contents = {};
let checksums = {};
let links = {};
for (const x of existing.metadata) {
    if (x.path.endsWith(&quot;.json&quot;)) {
        let basic = { ...x };
        delete basic._extra;
        contents[x.path] = JSON.stringify(basic);
        checksums[x.path] = await hash.md5(contents[x.path]);
    } else {
        links[x.path] = x[&quot;_extra&quot;][&quot;id&quot;];
    }
}

// Initializing the upload, creating links where possible.
await adb.uploadProject(
    example_url, 
    &quot;test-zircon-upload&quot;, 
    &quot;my_test_version&quot;, 
    checksums, 
    contents, 
    { initArgs: { dedupLinkPaths: links, expires: 1 } }
);
</code></pre></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Wed Oct 12 2022 15:52:07 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>